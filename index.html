<!DOCTYPE HTML>
<html>
<head>
<title>Home</title>
	<link href="css/bootstrap.css" rel="stylesheet">
<!-- jQuery (necessary JavaScript plugins) -->
<!-- Custom Theme files -->
	<link href='css/font.css' rel='stylesheet' type='text/css'>
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="js/jquery-ui.min.js"></script>
	<script type="text/javascript" src="js/bootstrap-3.1.1.min.js"></script>
    <script type="text/javascript" src="js/av-min-1.2.1.js"></script>
<!-- Custom Theme files -->
<!--//theme-style-->
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<style>
        *{ font-family: Microsoft YaHei,'宋体' , Tahoma, Helvetica, Arial, "\5b8b\4f53", sans-serif;}
		#left{
			border-style: solid;
			border-color: #0dc5dd;
			border-width: 0px 1px 0px 0px;
			height: 500px;
		}
        .w50{
            width: 100%;
        }
	</style>
    <script>
        //jQuery
        var APP_ID = 'nrQJolPEqzOK1qEKJM1feLON-9Nh9j0Va';

        // 应用 Key，用来校验权限（Web 端可以配置安全域名来保护数据安全）
        var APP_KEY = '7mpFcX7pBvw2gL4rmcJ81H3r';

        // 初始化
        AV.init({
            appId: APP_ID,
            appKey: APP_KEY
        });
        function toLogined(){ //到达已登陆状态
            var currentUser = AV.User.current();
            if (currentUser) { //已经登陆
                var username=currentUser.getUsername();
                var par = $("#loginDom").parent().parent();
                $("#loginDom").remove();
                par.html(username);
            }
        }
        function signUp() {  //注册
            var userName=$("#signUserName").val();
            var password=$("#signPassword").val();
            var email=$("#signEmail").val();
            var query = new AV.Query('_User');
            // 查询 priority 是 0 的 Todo
            query.equalTo('username', userName);
            var user = new AV.User();
            // 设置用户名
            user.setUsername(userName);
            // 设置密码
            user.setPassword(password);
            // 设置邮箱
            user.setEmail(email);
            user.signUp().then(function (loginedUser) {
                console.log(loginedUser);
                alert("注册成功，我们已经将验证信息发送至您的邮箱，请注意查收");
                $('#login').modal('show');
                $('#signUp').modal('hide');

            }, function (error) {
                alert(error.message);
                console.log(error.message);
            });
        }
        function forget(){
            var email=$("#forgetEmail").val();
            console.log(email);
            AV.User.requestPasswordReset(email).then(function (success) {
                alert("我们已经找回密码方式发送至"+email+"，请前往邮箱进行查看");
            }, function (error) {
                alert(error.message);
            });
        }
        function login() { //登陆
            var username=$("#logUserName").val();
            var password=$("#logPassword").val();
            AV.User.logIn(username, password).then(function (loginedUser) {
                //登陆成功

                $("#logSuccess").modal('show');
                $("#login").modal('hide');
                toLogined();
               // setTimeout(function(){$("#logSuccess").modal('hide');$("#login").modal('hide');},500);
                console.log(loginedUser);
            }, function (error) {
                alert("登陆失败"+error.message);
            });
           // $("#login").modal('hide');
        }
    </script>
</head>
<body>
<!---------下面是导航栏---->
<div class="container">
    <div class="row clearfix">
        <div class="col-md-12 column">
            <nav class="navbar navbar-fixed-top   navbar-default" role="navigation">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1"> <span class="sr-only">here</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button> <a class="navbar-brand" href="#">Brand</a>
                </div>
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <ul class="nav navbar-nav">
                        <li class="active">
                            <a href="#">Link</a>
                        </li>
                        <li>
                            <a href="#">Link</a>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown<strong class="caret"></strong></a>
                            <ul class="dropdown-menu">
                                <li>
                                    <a href="#">Action</a>
                                </li>
                                <li>
                                    <a href="#">Another action</a>
                                </li>
                                <li>
                                    <a href="#">Something else here</a>
                                </li>
                                <li class="divider">
                                </li>
                                <li>
                                    <a href="#">Separated link</a>
                                </li>
                                <li class="divider">
                                </li>
                                <li>
                                    <a href="#">One more separated link</a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                    <form class="navbar-form navbar-left" role="search">
                        <div class="form-group">
                            <input type="text" class="form-control" />
                        </div> <button type="submit" class="btn btn-default">Submit</button>
                    </form>
                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#signUp"  data-toggle="modal">
                                <button type="button" class="btn btn-default btn-success btn-block"> &nbsp;&nbsp;&nbsp;注册&nbsp;&nbsp;&nbsp; </button>
                            </a>
                        </li>
                        <li>
                            <a href="#login" data-toggle="modal" >
                                <button  id="loginDom" type="button" class="btn btn-default btn-success btn-block">&nbsp;&nbsp;&nbsp;登陆&nbsp;&nbsp;&nbsp;</button>
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
        </div>
    </div>
</div>
<!--上面是导航栏---->
<!-------------下面是遮罩窗体--->
    <div class="modal fade" id="signUp" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="myModalLabel1">
                        注册
                    </h4>
                </div>
                <div class="modal-body">
                    <form role="form">
                        <div class="form-group">
                            <label >用户名</label><input type="text" class="form-control" id="signUserName" />
                        </div>
                        <div class="form-group">
                            <label >密码</label><input type="password" class="form-control" id="signPassword" />
                        </div>
                        <div class="form-group">
                            <label >邮箱</label><input type="email" class="form-control" id="signEmial" />
                        </div>
                         <p type="submit" class="btn-default btn btn-success btn-block"   onclick="signup()">注册</p>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default btn-block btn-info" data-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="login" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="myModalLabel">
                        登陆
                    </h4>
                </div>
                <div class="modal-body">
                    <form role="form">
                        <div class="form-group">
                            <label >用户名</label><input type="text" class="form-control" id="logUserName" />
                        </div>
                        <div class="form-group">
                            <label >密码</label><input type="password" class="form-control" id="logPassword" />
                        </div>
                        <div class="form-group">
                            <p  class="btn btn-default btn-success btn-block" onclick="login()">登陆</p>
                        </div>
                        <div class="form-group">

                                <div class="row clearfix">
                                    <div class="col-md-6 column">
                                        <a href="#forget" data-toggle="modal" data-dismiss="modal"><button class="btn btn-default btn-block btn-info">忘记密码</button></a>
                                    </div>
                                    <div class="col-md-6 column">
                                        <a href="#signUp" data-toggle="modal" data-dismiss="modal"><button class="btn btn-default btn-block btn-info">前去注册</button></a>
                                    </div>
                                </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default btn-block btn-info" data-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="forget" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" >
                        忘记密码
                    </h4>
                </div>
                <div class="modal-body">
                    <form role="form">
                        <div class="form-group">
                            <label >注册邮箱</label><input type="email" class="form-control" id="forgetEmail" />
                        </div>
                        <p type="submit" class="btn btn-default btn-success btn-block" onclick="forget()">找回密码</p>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default btn-block btn-info" data-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>
    <!--下面是登陆成功-->
    <div class="modal fade" id="logSuccess" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h4 class="modal-title" >
                            登陆成功
                        </h4>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default btn-block btn-info" data-dismiss="modal">关闭</button>
                    </div>
                </div>
            </div>
        </div>
    <script type="text/javascript" >
        toLogined();
    </script>
</body>
</html>